# Instructiuni train_qa

## Parametri
Scriptul de antrenare se regaseste ori pe Desktop, ori in folderul “bat_scripts” din repository si are numele “train_qa.bat”. In cadrul rularii acestui script, **utilizatorul trebuie sa ia urmatoarele decizii**: 

1. Sursa datelor de antrenare:
    1. Din baza de date: se extrag documentele din baza de date, se preproceseaza si se salveaza in folderul “C:\allan\_cache/_data/” sub forma unor fisiere care incep cu “tags_titles_vX”, unde X este un numar..
    2. Dintr-un fisier .csv: fisierul trebuie sa contina o singura coloana pe care sa se regaseasca id-uri de documente care vor reprezenta documentele pe care se antreneaza modelul. In folderul “C:\allan” exista un fisier “ids.csv” cu rol de exemplu. 
    3. Dintr-un folder local, provenit dintr-o extragere anterioara. La fiecare rulare datele (cu tot cu preprocesarea necesara antrenarii) sunt salvate in folderul “C:\allan\_cache/_data” (vezi si primul punct). Acest mecanism permite reantrenarea unui model cu datele extrase anterior. Acest mecanism exista pentru ca procesul de extragere a datelor si preprocesare este unul de durata.
2. Numarul de epoci de antrenare. **Se recomanda sa se foloseasca valoarea default** gasita in urma procesului de antrenare-validare-testare (17 pentru get_tags).
3. Numarul de exemple dintr-un batch (batch size): Poate fi crescut pentru a facilita o antrenare mai rapida. Momentan este setat la valoarea default, valoare maxima pentru configuratia actuala. **Se recomanda sa se foloseasca valoarea default**.
4. Dimensiunea contextului pentru modelul BERT (maxim 512): **Se recomanda sa se foloseasca valoarea default (64)**.
5. Numarul de predictii pentru evaluare: strict pentru evaluarea de la finalul scripturilor, este numarul de predictii pe care il luam in calcul. ATENTIE: modelul poate prezice oricate valori (argumentul “TOP_N” din API!), dar pentru primele predictii modelul este intotdeauna mai “sigur” pe predictiile facute. Pentru evaluare limitam numarul predictiilor la acest parametru pentru a verifica performanta modelului: cate din primele k predictii sunt relevante? Aceasta valoare nu influenteza in niciun fel modelul final, el va putea fi apelat cu orice valoare “TOP_N”.

**Exceptand sursa datelor care depinde de tipul de rulare dorit, se recomanda sa fie folosite valorile default pentru toti ceilalti parametri**: epoci de antrenare, batch size, dimensiunea contextului pentru BERT. 

La finalul antrenarii urmeaza cateva informatii legate de numele sub care au fost salvate datele (daca e nevoie, vezi info la “sursa datelor”) si folderul in care a fost salvat modelul. In continuare urmeaza partea de evaluare. Pentru evaluare avem nevoie de un set de date extern (care nu apare in antrenare!). Pentru aceasta am folosit exemplele date in sheet-ul cu teste. Am constuit fisierul test_samples_qa.csv cu doua coloane: text si label-uri. Acesta se gaseste in “C:\allan”. Evaluarea finala se face pe aceste exemple.

In final exista optiunea de a face deploy la modelul tocmai antrenat, astfel el ajunge “live”. 

## Observatii
- Antrenarea modelelor se face pe ~120,000 de exemple pentru get_qa. Testele ‘test_samples_qa.csv’ contin foarte putine exemple.
Chiar si acelasi model antrenat de doua ori pe aceleasi date, cu aceeasi parametri poate da rezultate diferite pe aceste teste.
Avand foarte putin exemple, o predictie diferita cantareste foarte putin in performanta finala.
**De aceea Se recomanda extinderea setului de teste (practic extinderea fisierului test_samples_qa.csv) pana la cel putin 100 de exemple (atentie: exemple care nu se gasesc deja in setul de antrenare)**.
Cu cat sunt mai multe si mai diverse testele cu atat performanta pe acestea este mai reprezentativa pentru performanta generala a modelului.
- Se recomanda folosirea unui fisier .csv pentru antrenare (vezi explicatiile de la “sursa datelor”.
**Strict pentru get_qa, la folosirea unui fisier .csv se combina datele din baza de date (extragem titlurile documentelor) cu intrarile din .csv. Astfel, ca modelul sa obtina performante cat mai bune este de preferat ca in fisierul .csv sa exista macar 1000 de intrebari** (mai exact id-uri de documente, documente cu acelasi format ca titlurile: ‘select titlu from document where id=X” sa fie textul intrebarii si label-ul sa fie gasit cu ‘select tip_tematica.nume2 from entitate_x_tematica, tip_tematica where tip_tematica.id=entitate_x_tematica.id_tip_tematica and id_document={} ‘; la nevoie acest format se poate modifica!). Mai mult decat atat label-ul asociat intrebarii trebuie sa fie in lista label-urilor (vezi finalul acestui document)
- Pentru exemplele din spreadsheet (test_samples_qa.csv), nu toate label-urile pentru qa se gasesc in lista de la finalul documentului (din cauza ca aceste samples au fost definite inainte sa avem varianta finala de model care contine label-urile de la finalul documentului). Cele care nu se gasesc sunt pur si simplu ignorate la constructia corpusului de evaluarea.


## Lista label-uri pentru qa
'agricultura', 'eroi_nationali_comemorari', 'taxa_pe_valoare_adaugata', 'societati', 'industria_constructiilor_de_masini', 'contraventii', 'arta_si_cultura', 'constructii', 'relatii_externe_militare', 'uzucapiune_prescriptia_achizitiva', 'restituiri', 'proprietate_privata', 'mandat_mandatari', 'minoritati_nationale', 'epidemii', 'armata', 'relatii_culturale', 'prestari_de_servicii', 'burse_de_valori', 'drept_civil', 'regimul_strainilor', 'demisii', 'transfer', 'concurenta_si_monopol', 'recursuri_in_interesul_legii_admitere', 'relatii_externe', 'minerit', 'constitutionalitate', 'ape_si_paduri', 'silvicultura', 'protectia_animalelor', 'petrol', 'infractiuni_privind_autoritatea_si_frontiera_de_stat', 'arheologie', 'serviciul_de_informatii_externe', 'alegeri', 'politica_in_domeniul_pescuitului', 'personal_auxiliar', 'protectia_mediului', 'sponsorizare', 'alte_proceduri_speciale', 'vize', 'somaj', 'pietre_si_metale_pretioase', 'cereri', 'ambasadori_ambasade', 'amenzi', 'carte_funciara', 'cercetare_stiinta_tehnologie', 'asigurari_sociale', 'drept_de_proprietate', 'detinuti_politici', 'urmarirea_penala', 'nulitatea', 'inventii_inovatii', 'politie', 'hotarari_prealabile_admitere', 'infractiuni_contra_capacitatii_de_lupta_fortelor_armate', 'discriminare', 'aviatie_aeroporturi', 'drept_procesual_civil', 'sarbatori_legale_aniversari', 'guvern_si_institutii_in_subordine', 'imunitate', 'pompieri_prevenirea_incendiilor', 'gardienii_publici', 'mediere', 'faliment', 'gaze_naturale', 'autorizare', 'drept_comercial', 'fiscalitate', 'veterani_de_razboi', 'achizitii_publice', 'protectie_sociala', 'elevi_studenti', 'raspunderea_penala', 'marci_inregistrate_si_indicatii_geografice', 'infractiuni_electorale', 'stramutare', 'suspendarea_judecatii', 'produse_alimentare', 'nationalizare', 'executarea_silita', 'stare_de_alerta', 'zone_libere', 'proprietate_intelectuala', 'invatamant', 'obligatii_izvoare_transmisiuni_transformare_modalitati_stingere', 'minori', 'dividende', 'regimul_armelor_si_al_munitiilor', 'suspendarea_conditionata', 'masuri_asiguratorii', 'alte_contracte', 'asistenta_juridica', 'concedii', 'coronavirus', 'mediatori', 'divort', 'frontiera', 'actiuni_ca_valori', 'circulatie_rutiera', 'insolventa', 'asociatii_fundatii', 'relatii_diplomatice', 'penal', 'demolari', 'creante', 'contencios_administrativ_si_fiscal', 'buget', 'protectie_si_paza', 'extradare', 'angajari', 'industrie_alimentara', 'drepturile_omului', 'vanzari_cumparari', 'acte_ale_autoritatilor_publice', 'emisiuni_retrageri_monetare', 'contabili', 'religii_culte_parohii_cimitire_biserici', 'structuri_agricole', 'decontari', 'posesie', 'tutun_bauturi_alcoolice', 'comunicatii', 'mass_media', 'substante_toxice_explozive', 'informatica', 'privilegii_gaj_drept_de_retentie', 'garantii', 'medici', 'civil', 'transfer_de_proprietate', 'publicitate', 'cai_ferate_gari', 'delegatii_detasari', 'rezolutiune', 'detectivi_particulari', 'recensamant', 'targuri_si_expozitii', 'datorii', 'lucrari_drumuri_si_poduri', 'operatiuni_valutare_case_de_schimb', 'zone_defavorizate', 'comisii', 'domeniu_nuclear', 'judecata_in_prima_instanta_cai_de_atac_etc', 'subventii', 'actiuni_in_anulare_posesorie_regres_pauliana_etc', 'stare_de_necesitate_asediu_si_urgenta', 'probe_dovezi_procedee_probatorii', 'consilieri_juridici', 'timbre_fiscale', 'coproprietate_si_indiviziune', 'dispozitii_institutionale', 'concedieri', 'cinematografie', 'masuri_preventive', 'repatrieri', 'electronica', 'avocati', 'pedepse_categorii_calcul_individualizare_executare', 'adoptii', 'expertize', 'raspunderea_civila_delictuala', 'masuri_de_siguranta_si_educative', 'liberare_conditionata', 'restructurare_reorganizare', 'ajutoare_acordate_de_catre_state', 'reabilitare_de_drept_sau_judecatoreasca', 'inflatie', 'imprumuturi_credite_creditori', 'horticultura', 'persoane_persecutate_din_motive_politice', 'privatizare', 'exproprieri', 'ordonanta_presedintiala', 'modificari_de_capital', 'granituire', 'drept_administrativ', 'protectia_datelor_personale_gdpr', 'arhitecti', 'bunuri_si_valori_mobiliare', 'recursuri_in_interesul_legii_hotarari_prealabile_solutii_de_admitere', 'revolutionari_drepturi', 'medalii_distinctii', 'bunuri_si_valori_imobiliare', 'ipoteci', 'competenta_conflict_de_competenta', 'vicii_evictiuni', 'parlament', 'jandarmeria', 'alocatii', 'infractiuni_contra_persoanei', 'revocare', 'persoane_cu_handicap_persoane_cu_dizabilitati', 'vinovatie_clasificare_acord_de_recunoastere_etc', 'carne_de_vita_si_manzat', 'infractiuni_de_coruptie_si_de_serviciu', 'masuri_restrictive_sanctiuni_internationale', 'economic_relations', 'succesiuni_mosteniri', 'industrie_extractiva_petrochimie', 'nave_fluviale_porturi', 'drepturi_de_autor', 'organizare_judecatoreasca', 'consuli_consulate', 'simboluri_nationale_steme_embleme_sigilii', 'inchiriere', 'import_export', 'evidenta_populatiei_stare_civila', 'nave_maritime_porturi', 'loans_credits_creditors', 'hotarari_prealabile_respingere', 'recuzare', 'metrologie', 'minuta_si_dispozitivul', 'minori_si_familie', 'impozite_si_taxe', 'telefonie', 'serviciul_roman_de_informatii', 'sport_tineret', 'calificare_atestari_profesionale', 'cetatenie', 'pensii', 'banci_institutii', 'comisioane_comisionari', 'arhivistica', 'imigrare', 'diaspora', 'rezerve', 'actiunea_penala', 'termene_prescriptii', 'administratie_publica', 'rezervatii_naturale', 'oua_si_pasari', 'fondul_funciar', 'reziliere', 'taxe_vamale', 'statistica', 'audiovizual', 'supraveghere_financiara', 'casa_de_ajutor_reciproc', 'rechizitii', 'monumente_istorice', 'industrie_metalurgica', 'posta', 'suspendarea_executarii', 'standarde_etichete_ambalaje_marcare', 'ajutor_social', 'sanatate', 'drept_maritim_si_fluvial', 'industria_lemnului', 'recursuri_in_interesul_legii_hotarari_prealabile_solutii_de_respingere', 'liberare_provizorie', 'infractiuni_de_genocid_contra_umanitatii_si_de_razboi', 'control_financiar', 'antecontracte', 'licitatii', 'infractiuni_care_aduc_atingere_unor_relatii_privind_convietuirea_sociala', 'citare_citatie', 'medicina_veterinara', 'embargou', 'contracte_de_munca', 'finantare', 'partaj', 'protectia_copilului', 'relatii_de_familie', 'salarizare', 'infractiuni_contra_infaptuirii_justitiei', 'contabilitate', 'protectia_consumatorului', 'controlul_si_asigurarea_calitatii', 'marea_neagra', 'piscicultura', 'emigrare', 'ucraina', 'mandat_de_reprezentare', 'infractiuni_contra_patrimoniului', 'raporturi_de_munca', 'conferinte', 'uz_abitatie_uzufruct', 'congrese', 'donatii', 'absolventi', 'sindicate', 'plangeri_prealabile', 'calamitati_sinistrati', 'investitii', 'magistrati_magistratura', 'revendicare_actiuni_bunuri_drepturi', 'caz_fortuit_forta_majora', 'jocuri_de_noroc', 'accize', 'transport', 'infractiuni_contra_securitatii_nationale', 'industrie_farmaceutica', 'marci', 'casari', 'protectie_civila', 'psihologi_psihiatri', 'primari_primarii', 'dreptul_de_administrare', 'contestatie', 'cadre_didactice', 'apicultura', 'sericicultura', 'deseuri', 'refugiati', 'cadastru_intabulare', 'servicii_publice', 'diverse', 'litigii_cu_profesionistii', 'asigurari_auto', 'proprietate_publica', 'locuinte', 'vin', 'secrete_militare_si_de_stat', 'drept_contencios_administrativ_si_fiscal', 'vama', 'concesionari_concesiuni', 'legislatie_fitosanitara', 'politica_externa_si_de_securitate_comuna', 'litigii_de_munca', 'taxe_judiciare_de_timbru', 'partide_politice', 'reconventionalitate_actiuni_cereri', 'carburanti_combustibili', 'servituti', 'acord_de_asociere', 'leasing', 'drept_procesual_penal', 'cautiune', 'dobanzi', 'fonduri', 'ajutoare_umanitare', 'cesiune', 'fondul_european_de_orientare_si_garantare_agricola_feoga', 'regii_autonome', 'despagubiri', 'gratieri_si_amnistii', 'turism', 'asigurari', 'urbanism', 'protectia_muncii', 'financiar', 'medicina_umana', 'industrie_energetica', 'prefecturi_prefecti', 'conflict_de_munca', 'relatii_economice', 'expulzare', 'licente_si_brevete', 'notari_si_activitate_notariala', 'comert', 'infractiuni_de_fals', 'viticultura', 'edituri_si_publicatii_scrieri', 'pescuit_si_vanatoare', 'arest_preventiv', 'institutii', 'unitatea_si_pluralitatea_de_infractiuni', 'martori', 'arbitraj', 'manifestari_culturale_publice', 'audit', 'infractiuni_contra_sigurantei_publice', 'industrie_usoara', 'industrie_chimica', 'cambie', 'zootehnie', 'agronomie', 'meteorologie', 'penitenciare_condamnati', 'plati', 'irigatii'
